# Code Structure (Hexagonal Architecture)

This diagram visualizes the internal structure of the `buckpal` application, following the **Ports and Adapters** (Hexagonal) architecture pattern.

```mermaid
classDiagram
    %% Domain Layer
    namespace Domain {
        class Account {
            +withdraw(Money, AccountId)
            +deposit(Money, AccountId)
        }
    }

    %% Ports (In)
    namespace InputPorts {
        class SendMoneyUseCase {
            <<interface>>
            +sendMoney(SendMoneyCommand)
        }
    }

    %% Application Layer
    namespace Application {
        class SendMoneyService {
            +sendMoney(SendMoneyCommand)
        }
    }

    %% Ports (Out)
    namespace OutputPorts {
        class LoadAccountPort {
            <<interface>>
            +loadAccount(AccountId, LocalDateTime)
        }
        class UpdateAccountStatePort {
            <<interface>>
            +updateActivities(Account)
        }
    }

    %% Adapters (In)
    namespace WebAdapter {
        class SendMoneyController {
            +sendMoney(Long, Long, Long)
        }
    }

    %% Adapters (Out)
    namespace PersistenceAdapter {
        class AccountPersistenceAdapter {
            +loadAccount(AccountId, LocalDateTime)
            +updateActivities(Account)
        }
    }

    %% Relationships
    SendMoneyController --> SendMoneyUseCase : uses
    SendMoneyService ..|> SendMoneyUseCase : implements
    SendMoneyService --> LoadAccountPort : uses
    SendMoneyService --> UpdateAccountStatePort : uses
    SendMoneyService --> Account : uses
    AccountPersistenceAdapter ..|> LoadAccountPort : implements
    AccountPersistenceAdapter ..|> UpdateAccountStatePort : implements
```

## Key Components

- **Web Adapter**: `SendMoneyController` receives HTTP requests and calls the input port.
- **Input Port**: `SendMoneyUseCase` defines the interface for the use case.
- **Application Service**: `SendMoneyService` implements the business logic, orchestrating the flow between the domain and output ports.
- **Domain**: `Account` contains the core business rules (e.g., checking balance).
- **Output Ports**: `LoadAccountPort` and `UpdateAccountStatePort` define interfaces for data access.
- **Persistence Adapter**: `AccountPersistenceAdapter` implements the output ports to interact with the database (via Spring Data JPA).
